
# Домашнее задание к занятию "11.04 Микросервисы: масштабирование"

Вы работаете в крупной компанию, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps специалисту необходимо выдвинуть предложение по организации инфраструктуры, для разработки и эксплуатации.

## Задача 1: Кластеризация

Предложите решение для обеспечения развертывания, запуска и управления приложениями.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- Поддержка контейнеров;
- Обеспечивать обнаружение сервисов и маршрутизацию запросов;
- Обеспечивать возможность горизонтального масштабирования;
- Обеспечивать возможность автоматического масштабирования;
- Обеспечивать явное разделение ресурсов доступных извне и внутри системы;
- Обеспечивать возможность конфигурировать приложения с помощью переменных среды, в том числе с возможностью безопасного хранения чувствительных данных таких как пароли, ключи доступа, ключи шифрования и т.п.

Обоснуйте свой выбор.

**Ответ**

На основе Кубернетиса. 
Для  обнаружения сервисов: Балансировщик F5. На примере поддерживаемой ИС - работает прекрасно. Тушим сервисы - запросы идут на работающую ноду(унаследовал не настраивал), поднимаем сервисы - тут же восстанавливается поток. Восторг. 

Для "горизонта" и автомата: в подах сервисов использовать решения сбора метрик, например prometeus, пробросить сеть до kubectl ноды для этого решения. Завести в кроне задачу, в .sh описать сбор показателей их расчет, логику масштабирования.  Или руками сопровождения делать все тоже самое.
Либо использовать модуль кубера, что-то вроде kubectl autoscale deployment.v1.apps/nginx-deployment --min=10 --max=15 --cpu-percent=80

Для разделения ресурсов: публикация сервисов на отдельном порту на отдельном Veth для внешнего доступа. Со своей рест-моделью в отдельный сервисе в поде. Позволит переносить и масштабировать или даже выключать при необходимости, или отсечь подсеть.

Для конфигурации через среду: Использование env: для параметров подключения к бд или другим каким либо ресурсам - ок. Пароли лучше оставить внутри PODов в файлах если возможно в base64.
Хотя если нагуглить, есть вариант использования, на примере пода с секретом:

Создать файл yaml с описанием секрета
```
--- 
apiVersion: v1
data: 
  password: base64 строка с паролем
  username: base64 строка с логином
kind: Secret
metadata: 
  name: database-creds
type: Opaque
```
Создать секрет из файла
```
kubectl create -f creds.yaml
secret "database-creds" created
```
Использовать в ямл подов этот секрет
```
env: 
        - 
          name: MYSQL_USER
          valueFrom: 
            secretKeyRef: 
              key: username
              name: database-creds
        - 
          name: MYSQL_PASSWORD
          valueFrom: 
            secretKeyRef: 
              key: password
              name: database-creds
```

## Задача 2: Распределенный кэш * (необязательная)

Разработчикам вашей компании понадобился распределенный кэш для организации хранения временной информации по сессиям пользователей.
Вам необходимо построить Redis Cluster состоящий из трех шард с тремя репликами.

### Схема:

![11-04-01](https://user-images.githubusercontent.com/1122523/114282923-9b16f900-9a4f-11eb-80aa-61ed09725760.png)

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
